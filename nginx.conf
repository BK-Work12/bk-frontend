# Nginx config for Next.js static export (output: export, distDir: build, trailingSlash: true).
# Ensures /invest/1 and /invest/1/ both serve invest/1/index.html on refresh/direct load.
# Deploy: point root to your build output (e.g. /var/www/dashboard.varntix.com/build).

server {
  listen 80;
  server_name dashboard.varntix.com;
  root /var/www/dashboard.varntix.com/build;   # adjust to your deploy path

  # Invest detail pages: /invest/1 and /invest/1/ -> invest/1/index.html (avoids 404 on refresh)
  # MUST: set root to the directory that contains invest/ (i.e. Next build output, e.g. .../build).
  location ~ ^/invest/([^/]+)/?$ {
    index index.html;
    try_files /invest/$1/index.html /invest/$1.html $uri $uri/ /index.html;
  }

  location / {
    try_files $uri $uri/ $uri.html $uri/index.html /index.html =404;
  }

  # Optional: security headers
  add_header X-Frame-Options "SAMEORIGIN" always;
  add_header X-Content-Type-Options "nosniff" always;
}

# HTTPS (uncomment and adjust when using SSL)
# server {
#   listen 443 ssl http2;
#   server_name dashboard.varntix.com;
#   root /var/www/dashboard.varntix.com/build;
#   ssl_certificate /path/to/fullchain.pem;
#   ssl_certificate_key /path/to/privkey.pem;
#   location ~ ^/invest/([^/]+)/?$ {
#     try_files /invest/$1/index.html /invest/$1.html $uri $uri/ /index.html =404;
#   }
#   location / {
#     try_files $uri $uri/ $uri.html $uri/index.html /index.html =404;
#   }
# }
